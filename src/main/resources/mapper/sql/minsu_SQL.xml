<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="minsu">
	
	<select id="selectUserTest" parameterType="hashmap" resultType="map">
		<![CDATA[
			SELECT
			    *
			FROM
			    user
		]]>
	</select>
	

	<!-- 스템프 적립 일자별 seq발생 -->
	<insert id="insertAddStamp" parameterType="map">
		
		<selectKey keyProperty="key_seq" resultType="String" order="BEFORE">
				<![CDATA[
				select ifnull(max(stampNum),0)+1 seq
				from stamplist
				where userId=(select userId from user where userTel=#{userTel})
				  and businessId = #{businessId}
				  and stampDate =curdate()
			]]>
        </selectKey>
	
		<![CDATA[
			INSERT
				INTO stamplist(
			    	userId,
			    	businessId,
			    	stampDate,
			    	stampNum
			    	)
				VALUES(
					(select userId from user where userTel=#{userTel}),
			    	#{businessId},
			    	curdate(),
			    	#{key_seq}
			    )
		]]>
	</insert>	
	
	<!-- 정회원 확인-->
	<select id="selectCheck" parameterType="map" resultType="String">
		<![CDATA[
			SELECT
			    userId
			FROM
			    user
			WHERE
				userTel=#{userTel}
		]]>
	</select>
	
	<!-- 준회원 등록-->
	<insert id="insertUser" parameterType="hashmap">
		<![CDATA[
			INSERT
				INTO user(
			    	userTel,
			    	userCode
			    	)
				VALUES(
					#{userTel},
			    	4
			    )
		]]>
	</insert>	
	
	<!-- 준회원 즐겨찾기 등록-->
	<insert id="insertJunMembership" parameterType="hashmap">
		<![CDATA[
			INSERT
				INTO membership(
			    	userId,
			    	businessId
			    	)
				VALUES(
					(select userId from user where userTel=#{userTel}),
			    	#{businessId}
			    )
		]]>
	</insert>	
	
	
</mapper>

